test_name: Make sure a non active run cannot be paused

marks:
  - usefixtures:
      - run_server

stages:
  - name: Upload a protocol
    request:
      url: '{host:s}:{port:d}/protocols'
      method: POST
      files:
        files: 'tests/integration/protocols/load_one_labware.py'
    response:
      status_code: 201
      save:
        json:
          protocol_id: data.id

  - name: Create a run
    request:
      url: '{host:s}:{port:d}/runs'
      json:
        data:
          protocolId: '{protocol_id}'
      method: POST
    response:
      strict:
        - json:off
      status_code: 201
      json:
        data:
          id: !anystr
          status: idle
          current: true
      save:
        json:
          run_id: data.id

  - name: Issue pause to a none active run
    request:
      url: '{host:s}:{port:d}/runs/{run_id}/actions'
      json:
        data:
          actionType: pause
      method: POST
    response:
      status_code: 409
      json:
        errors:
          - id: 'RunActionNotAllowed'
            title: 'Run Action Not Allowed'
            detail: 'Cannot pause a run that is not running.'

  - name: Stop the run
    request:
      url: '{host:s}:{port:d}/runs/{run_id}/actions'
      method: POST
      json:
        data:
          actionType: stop
    response:
      status_code: 201
